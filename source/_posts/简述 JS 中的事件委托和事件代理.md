---
titile: 简述 JS 中的事件委托和事件代理
---

**JS 中的事件委托和事件代理**

什么是事件委托？

事件委托还有一个名字叫事件代理，JS 高程上讲：事件委托就是利用事件冒泡，只制定一个时间处理程序，就可以管理某一类型的所有事件。我用取快递来解释这个现象： 有三个同事预计会在周一收到快递。为签收快递，有两种办法：一是三个人在公司门口等快递；二是委托给前台代为签收。现实当中，我们大都采用委托的方案。前台收到快递后，她会判断收件人是谁，然后按照收件人的要求签收，甚至代为付款。这种方案还有一个优势，那就是即使公司里来了新员工（不管多少），前台也会在收到寄给新员工的快递后核实并代为签收。

**一、背景介绍**

这里其实还有 2 层意思的：

第一，现在委托前台的同事是可以代为签收的，即程序中的现有的 dom 节点是有事件的；

第二，新员工也是可以被前台代为签收的，即程序中新添加的 dom 节点也是有事件的。

**二、知识剖析**

2.1 为什么要用事件委托

在 JavaScript 中，添加到页面上的事件处理程序数量将直接关系到页面的整体运行性能，因为需要不断的与 dom 节点进行交互，访问 dom 的次数越多，引起浏览器重绘与重排的次数也就越多，就会延长整个页面的交互就绪时间，这就是为什么性能优化的主要思想之一就是减少 DOM 操作的原因；每个函数都是一个对象，是对象就会占用内存，对象越多，内存占用率越大，100 个 li 就要占用 100 个内存空间。如果要用事件委托，就会将所有的操作放到 js 程序里面，只对它的父级 (如果只有一个父级) 这一个对象进行操作，与 dom 的操作就只需要交互一次，这样就能大大的减少与 dom 的交互次数，提高性能；

2.2 事件委托的原理

事件委托是利用事件的冒泡原理来实现的，何为事件冒泡呢？就是事件从最深的节点开始，然后逐步向上传播事件，举个例子：页面上有这么一个节点树，div>ul>li>a; 比如给最里面的 a 加一个 click 点击事件，那么这个事件就会一层一层的往外执行，执行顺序 a>li>ul>div，有这样一个机制，那么我们给最外面的 div 加点击事件，那么里面的 ul，li，a 做点击事件的时候，都会冒泡到最外层的 div 上，所以都会触发，这就是事件委托，委托它们父级代为执行事件。

子节点实现相同的功能：实现功能是点击 li，弹出 123

![](http://upload-images.jianshu.io/upload_images/7503015-4e260b47b00d4bcf.png)

我们看看有多少次的 dom 操作，首先要找到 ul，然后遍历 li，然后点击 li 的时候，又要找一次目标的 li 的位置，才能执行最后的操作，每次点击都要找一次 li；

子节点实现相同的功能：实现功能是点击 li，弹出 123

那么我们用事件委托的方式做又会怎么样呢？

![](http://upload-images.jianshu.io/upload_images/7503015-2421861e8b2fdb07.png)

这里用父级 ul 做事件处理，当 li 被点击时，由于冒泡原理，事件就会冒泡到 ul 上，因为 ul 上有点击事件，所以事件就会触发，当然，这里当点击 ul 的时候，也是会触发的.

2.3 事件冒泡及捕获

DOM2.0 模型将事件处理流程分为三个阶段：一、事件捕获阶段，二、事件目标阶段，三、事件起泡阶段。如图：

![](http://upload-images.jianshu.io/upload_images/7503015-3207c2ef357563a9.png)

事件捕获：当某个元素触发某个事件（如 onclick），顶层对象 document 就会发出一个事件流，随着 DOM 树的节点向目标元素节点流去，直到到达事件真正发生的目标元素。在这个过程中，事件相应的监听函数是不会被触发的。 事件目标：当到达目标元素之后，执行目标元素该事件相应的处理函数。如果没有绑定监听函数，那就不执行。 事件起泡：从目标元素开始，往顶层元素传播。途中如果有节点绑定了相应的事件处理函数，这些函数都会被触发。

2.4 事件委托的优点

通过刚才的对比介绍，大家应该能够体会到使用事件委托对于 web 应用程序带来的几个优点： 1. 管理的函数变少了。不需要为每个元素都添加监听函数。对于同一个父节点下面类似的子元素，可以通过委托给父元素的监听函数来处理事件。 2. 可以方便地动态添加和修改元素，不需要因为元素的改动而修改事件绑定。 3.JavaScript 和 DOM 节点之间的关联变少了，这样也就减少了因循环引用而带来的内存泄漏发生的概率。

**3. 常见问题**

如果我想让事件代理的效果跟直接给节点的事件效果一样怎么办?

比如说只有点击 li 才会触发?

**4. 解决方案**

Event 对象提供了一个属性叫 target，可以返回事件的目标节点，我们成为事件源，也就是说，target 就可以表示为当前的事件操作的 dom，但是不是真正操作 dom。标准浏览器用 ev.target，IE 浏览器用 event.srcElement，此时只是获取了当前节点的位置，并不知道是什么节点名称，这里我们用 nodeName 来获取具体是什么标签名。这样改下就只有点击 li 会触发事件了，且每次只执行一次 dom 操作

![](http://upload-images.jianshu.io/upload_images/7503015-20b5f98519d72a50.png)

**5. 编码实战**

现在讲的都是 document 加载完成的现有 dom 节点下的操作，那么如果是新增的节点，新增的节点会有事件吗？现在是移入 li，li 变红，移出 li，li 变白，这么一个效果，然后点击按钮，可以向 ul 中添加一个 li 子节点

![](http://upload-images.jianshu.io/upload_images/7503015-d7740f748cfe8b89.png)

我们可以发现，当用事件委托的时候，根本就不需要去遍历元素的子节点，只需要给父级元素添加事件就好了，其他的都是在 js 里面的执行，这样可以大大的减少 dom 操作，这才是事件委托的精髓所在。

什么样的事件可以用事件委托，什么样的事件不可以用呢？ 适合用事件委托的事件：click，mousedown，mouseup，keydown，keyup，keypress。（所有用到按钮的事件，多数的鼠标事件和键盘事件） 值得注意的是，mouseover 和 mouseout 虽然也有事件冒泡，但是处理它们的时候需要特别的注意，因为需要经常计算它们的位置，处理起来不太容易。 不适合的就有很多了，举个例子，mousemove，每次都要计算它的位置，非常不好把控，在不如说 focus，blur 之类的，本身就没用冒泡的特性，自然就不能用事件委托了。

**七、扩展思考**

参考一：[陈鑫伟的博客](https://link.jianshu.com/?t=https%3A%2F%2Fwww.cnblogs.com%2FowenChen%2Farchive%2F2013%2F02%2F18%2F2915521.html)

参考二：[tony1223](https://link.jianshu.com/?t=http%3A%2F%2Fithelp.ithome.com.tw%2Farticles%2F10120565)

**八、视频链接**

![](https://upload.jianshu.io/videos/cover_imgs/null?imageView2/1/w/90/h/90)

undefined_腾讯视频

技能树. IT 修真院

“我们相信人人都可以成为一个工程师，现在开始，找个师兄，带你入门，掌控自己学习的节奏，学习的路上不再迷茫”。

这里是技能树. IT 修真院，成千上万的师兄在这里找到了自己的学习路线，学习透明化，成长可见化，师兄 1 对 1 免费指导。快来与我一起学习吧 ！

感谢大家的阅读！